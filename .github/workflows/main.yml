on:
  push:
    branches:
      - main

name: ğŸš€ Deploy React (Vite) App on push

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest

    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v2

      - name: ğŸ§° Install dependencies
        run: npm install

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸŒ Check DNS
        run: |
          echo "Checking DNS for www.thecodemode.com..."
          nslookup www.thecodemode.com

      - name: ğŸ“‚ Deploy dist folder to FTP (with retry)
        run: |
          n=0
          until [ $n -ge 3 ]
          do
            n=$((n+1))
            echo "Attempt $n to deploy..."
            npx ftp-deploy --server www.thecodemode.com \
                           --username "${{ secrets.ftp_username }}" \
                           --password "${{ secrets.ftp_password }}" \
                           --local-dir dist/ \
                           --server-dir /public_html/ && break
            echo "âš ï¸ Deployment failed. Retrying in 10 seconds..."
            sleep 10
          done
